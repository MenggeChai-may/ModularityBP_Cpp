

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Louvain Parallel Extension &mdash; CHAMP 1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="CHAMP 1 documentation" href="../index.html"/>
        <link rel="prev" title="Visualizing Results" href="plotting2.html"/> 

  
  <script src="js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> CHAMP
          

          
          </a>

          
            
            
              <div class="version">
                1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">CHAMP (Convex Hull of Admissible Modularity Partitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running CHAMP</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotting2.html">Visualizing Results</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Louvain Parallel Extension</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#partition-ensemble-example">Partition Ensemble Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-and-managing-large-partition-sets">Creating and Managing Large Partition Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="#saving-and-loading-partitionensembles">Saving and Loading PartitionEnsembles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#merging-partitionensembles">Merging PartitionEnsembles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#improvement-with-hdf5-saving-and-loading">Improvement with HDF5 saving and loading</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CHAMP</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Louvain Parallel Extension</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/_static/louvain_ext.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="louvain-parallel-extension">
<span id="louvain-ext"></span><h1>Louvain Parallel Extension<a class="headerlink" href="#louvain-parallel-extension" title="Permalink to this headline">¶</a></h1>
<p>CHAMP can be used with partitions generated by any community detection algorithm.  One of the most popular and fast algorithms is known as Louvain <a class="reference internal" href="#blondel-2008vn" id="id1">[1]</a> .  We provide an extension to the python package developed by Vincent Traag, <a class="reference external" href="https://github.com/vtraag/louvain-igraph">louvain_igraph</a>  <a class="reference internal" href="#traag-louvain" id="id2">[2]</a> to run Louvain in parallel, while calculating the coefficients necessary for CHAMP.  Currently, this extension only support single-layer network.  The random seed is set within each parallel process to ensure that the results are
stochastic over each run.  In general this is desireable because Louvain uses a greedy optimization schema that finds <em>local</em> optima.</p>
<dl class="function">
<dt id="champ.parallel_louvain">
<code class="descclassname">champ.</code><code class="descname">parallel_louvain</code><span class="sig-paren">(</span><em>graph</em>, <em>start=0</em>, <em>fin=1</em>, <em>numruns=200</em>, <em>maxpt=None</em>, <em>numprocesses=None</em>, <em>attribute=None</em>, <em>weight=None</em>, <em>node_subset=None</em>, <em>progress=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/champ/louvain_ext.html#parallel_louvain"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#champ.parallel_louvain" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates arguments for parallel function call of louvain on graph</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>graph</strong> &#8211; igraph object to run Louvain on</li>
<li><strong>start</strong> &#8211; beginning of range of resolution parameter <span class="math">\(\gamma\)</span> . Default is 0.</li>
<li><strong>fin</strong> &#8211; end of range of resolution parameter <span class="math">\(\gamma\)</span>.  Default is 1.</li>
<li><strong>numruns</strong> &#8211; number of intervals to divide resolution parameter, <span class="math">\(\gamma\)</span> range into</li>
<li><strong>maxpt</strong> (<em>int</em>) &#8211; Cutoff off resolution for domains when applying CHAMP. Default is None</li>
<li><strong>numprocesses</strong> &#8211; the number of processes to spawn.  Default is number of CPUs.</li>
<li><strong>weight</strong> &#8211; If True will use &#8216;weight&#8217; attribute of edges in runnning Louvain and calculating modularity.</li>
<li><strong>node_subset</strong> &#8211; Optionally list of indices or attributes of nodes to keep while partitioning</li>
<li><strong>attribute</strong> &#8211; Which attribute to filter on if node_subset is supplied.  If None, node subset is assumed      to be node indices.</li>
<li><strong>progress</strong> &#8211; Print progress in parallel execution</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">PartitionEnsemble of all partitions identified.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>We also have created a convenient class for managing and merging groups of partitions called <a class="reference internal" href="#champ.PartitionEnsemble" title="champ.PartitionEnsemble"><code class="xref py py-mod docutils literal"><span class="pre">champ.PartitionEnsemble</span></code></a> .  This class stores the partitions in membership vector form ( i.e. a list of N community assignments), as well as the coefficients for the partitions.  As part of its constructor, the PartitionEnsemble applies CHAMP to all of its partitions, and stores the domains of dominance.</p>
<span class="target" id="louvain-ext-partitionensemble"></span><dl class="class">
<dt id="champ.PartitionEnsemble">
<em class="property">class </em><code class="descclassname">champ.</code><code class="descname">PartitionEnsemble</code><span class="sig-paren">(</span><em>graph=None</em>, <em>listofparts=None</em>, <em>name='unnamed_graph'</em>, <em>maxpt=None</em>, <em>min_com_size=5</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/champ/louvain_ext.html#PartitionEnsemble"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#champ.PartitionEnsemble" title="Permalink to this definition">¶</a></dt>
<dd><p>Group of partitions of a graph stored in membership vector format</p>
<p>The attribute for each partition is stored in an array and can be indexed</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Variables:</th><td class="field-body"><ul class="first last simple">
<li><strong>graph</strong> &#8211; The graph associated with this PartitionEnsemble.  Each ensemble     can only have a single graph and the nodes on the graph must be orded the same as     each of the membership vectors.</li>
<li><strong>partitions</strong> &#8211; of membership vectors for each partition.  If h5py is set this is a dummy     variable that allows access to the file, but never actually hold the array of parititons.</li>
<li><strong>int_edges</strong> &#8211; Number of edges internal to the communities</li>
<li><strong>exp_edges</strong> &#8211; Number of expected edges (based on configuration model)</li>
<li><strong>resoltions</strong> &#8211; If partitions were idenitfied with Louvain, what resolution     were they identified at (otherwise None)</li>
<li><strong>orig_mods</strong> &#8211; Modularity of partition at the resolution it was identified at     if Louvain was used (otherwise None).</li>
<li><strong>numparts</strong> &#8211; number of partitions</li>
<li><strong>ind2doms</strong> &#8211; Maps index of dominant partitions to boundary points of their dominant     domains</li>
<li><strong>ncoms</strong> &#8211; List with number of communities for each partition</li>
<li><strong>min_com_size</strong> &#8211; How many nodes must be in a community for it to count towards the number     of communities.  This eliminates very small or unstable communities.  Default is 5</li>
<li><strong>unique_partition_indices</strong> &#8211; The indices of the paritions that represent unique coefficients.  This will be a     subset of all the partitions.</li>
<li><a class="reference internal" href="#champ.louvain_ext.PartitionEnsemble.hdf5_file" title="champ.louvain_ext.PartitionEnsemble.hdf5_file"><strong>hdf5_file</strong></a> &#8211; Current hdf5_file.  If not None, this serves as the default location for loading and writing     partitions to, as well as the default location for saving.</li>
<li><a class="reference internal" href="#champ.louvain_ext.PartitionEnsemble.twin_partitions" title="champ.louvain_ext.PartitionEnsemble.twin_partitions"><strong>twin_partitions</strong></a> &#8211; We define twin partitions as those that have the same coefficients, but are actually     different partitions.  This and the unique_partition_indices are only calculated on demand which can take some time.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="section" id="partition-ensemble-example">
<h2>Partition Ensemble Example<a class="headerlink" href="#partition-ensemble-example" title="Permalink to this headline">¶</a></h2>
<p>We use igraph to generate a random ER graph, call louvain in parallel, and apply CHAMP to the ensemble.  This example took approximately 1 minute to run on 2 cores.  We can use the PartitionEnsemble object to check whether all of the coefficients are unique, and to check whether all of the partitions themselve are unique (it is possible for two unique
partitions to give rise to the same coefficients).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">champ</span>
<span class="kn">import</span> <span class="nn">igraph</span> <span class="k">as</span> <span class="nn">ig</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">test_graph</span><span class="o">=</span><span class="n">ig</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">Erdos_Renyi</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span><span class="n">p</span><span class="o">=.</span><span class="mi">05</span><span class="p">)</span>
<span class="c1">#Create temporary file for calling louvain</span>
<span class="n">tfile</span><span class="o">=</span><span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span>
<span class="n">test_graph</span><span class="o">.</span><span class="n">write_graphmlz</span><span class="p">(</span><span class="n">tfile</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<span class="c1"># non-parallelized wrapper</span>
<span class="n">ens1</span><span class="o">=</span><span class="n">champ</span><span class="o">.</span><span class="n">run_louvain</span><span class="p">(</span><span class="n">tfile</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">nruns</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># parallelized wrapper</span>
<span class="n">test_graph2</span><span class="o">=</span><span class="n">ig</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">Random_Bipartite</span><span class="p">(</span><span class="n">n1</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">n2</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">p</span><span class="o">=.</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ens2</span><span class="o">=</span><span class="n">champ</span><span class="o">.</span><span class="n">parallel_louvain</span><span class="p">(</span><span class="n">test_graph2</span><span class="p">,</span>
                                  <span class="n">numruns</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fin</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">maxpt</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                  <span class="n">numprocesses</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                                  <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> of </span><span class="si">%d</span><span class="s2"> partitions are unique&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ens2</span><span class="o">.</span><span class="n">unique_partition_indices</span><span class="p">),</span><span class="n">ens2</span><span class="o">.</span><span class="n">numparts</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> of </span><span class="si">%d</span><span class="s2"> partitions after application of CHAMP&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ens2</span><span class="o">.</span><span class="n">ind2doms</span><span class="p">),</span><span class="n">ens2</span><span class="o">.</span><span class="n">numparts</span><span class="p">))</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Number of twin sets:&quot;</span><span class="p">)</span>
<span class="nb">print</span> <span class="p">(</span><span class="n">ens2</span><span class="o">.</span><span class="n">twin_partitions</span><span class="p">)</span>
<span class="c1">#plot both of these</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">f</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">a3</span><span class="o">=</span><span class="n">a</span>
<span class="n">champ</span><span class="o">.</span><span class="n">plot_single_layer_modularity_domains</span><span class="p">(</span><span class="n">ens2</span><span class="o">.</span><span class="n">ind2doms</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">a1</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">champ</span><span class="o">.</span><span class="n">plot_similarity_heatmap_single_layer</span><span class="p">(</span><span class="n">ens2</span><span class="o">.</span><span class="n">partitions</span><span class="p">,</span><span class="n">ens2</span><span class="o">.</span><span class="n">ind2doms</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">a2</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#PartitionEnsemble has method to plot downsampled summary of all partitions</span>
<span class="c1">#with optmal transitions and number of communities overlayed.</span>

<span class="n">ens2</span><span class="o">.</span><span class="n">plot_modularity_mapping</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">a3</span><span class="p">,</span><span class="n">no_tex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Output:</p>
<div class="line-block">
<div class="line">Run 0 at gamma = 0.000.  Return time: 0.0264</div>
<div class="line">Run 200 at gamma = 0.800.  Return time: 0.0621</div>
<div class="line">Run 100 at gamma = 0.400.  Return time: 0.0589</div>
<div class="line">Run 300 at gamma = 1.200.  Return time: 0.0660</div>
<div class="line">Run 400 at gamma = 1.600.  Return time: 0.0963</div>
<div class="line">Run 500 at gamma = 2.000.  Return time: 0.0970</div>
<div class="line">Run 600 at gamma = 2.400.  Return time: 0.0828</div>
<div class="line">Run 700 at gamma = 2.800.  Return time: 0.0769</div>
<div class="line">Run 800 at gamma = 3.200.  Return time: 0.0763</div>
<div class="line">Run 900 at gamma = 3.600.  Return time: 0.0818</div>
<div class="line">847 of 1000 partitions are unique</div>
<div class="line">11 of 1000 partitions after application of CHAMP</div>
<div class="line">Number of twin sets:</div>
<div class="line-block">
<div class="line">[]</div>
<div class="line"><br /></div>
</div>
</div>
<p>We see that there are a number of identical partitions here, there are no twin partitions .  That is different partitions with the same coefficents.</p>
<a class="reference internal image-reference" href="../_images/part_ens_exp.png" id="part-ens-exp"><img alt="../_images/part_ens_exp.png" id="part-ens-exp" src="../_images/part_ens_exp.png" style="width: 90%;" /></a>
<dl class="method">
<dt id="champ.louvain_ext.PartitionEnsemble.apply_CHAMP">
<code class="descclassname">PartitionEnsemble.</code><code class="descname">apply_CHAMP</code><span class="sig-paren">(</span><em>maxpt=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/champ/louvain_ext.html#PartitionEnsemble.apply_CHAMP"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#champ.louvain_ext.PartitionEnsemble.apply_CHAMP" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply CHAMP to the partition ensemble.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>maxpt</strong> (<em>int</em>) &#8211; maximum domain threshhold for included partition.  I.e         partitions with a domain greater than maxpt will not be included in pruned         set</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="champ.louvain_ext.PartitionEnsemble.plot_modularity_mapping">
<code class="descclassname">PartitionEnsemble.</code><code class="descname">plot_modularity_mapping</code><span class="sig-paren">(</span><em>ax=None</em>, <em>downsample=2000</em>, <em>champ_only=False</em>, <em>legend=True</em>, <em>no_tex=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/champ/louvain_ext.html#PartitionEnsemble.plot_modularity_mapping"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#champ.louvain_ext.PartitionEnsemble.plot_modularity_mapping" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot a scatter of the original modularity vs gamma with the modularity envelope super imposed.         Along with communities vs <span class="math">\(\gamma\)</span> on a twin axis.  If no orig_mod values are stored in the         ensemble, just the modularity envelope is plotted.  Depending on the backend used to render plot         the latex in the labels can cause error.  If you are getting RunTime errors when showing or saving         the plot, try setting no_tex=True</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ax</strong> (<em>matplotlib.Axes</em>) &#8211; axes to draw the figure on.</li>
<li><strong>champ_only</strong> (<em>bool</em>) &#8211; Only plot the modularity envelop represented by the CHAMP identified subset.</li>
<li><strong>downsample</strong> (<em>int</em>) &#8211; for large number of runs, we down sample the scatter for the number of communities         and the original partition set.  Default is 2000 randomly selected partitions.</li>
<li><strong>legend</strong> (<em>bool</em>) &#8211; Add legend to the figure.  Default is true</li>
<li><strong>no_tex</strong> (<em>bool</em>) &#8211; Use latex in the legends.  Default is true.  If error is thrown on plotting try setting         this to false.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">axes drawn upon</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">matplotlib.Axes</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="champ.louvain_ext.PartitionEnsemble.get_unique_partition_indices">
<code class="descclassname">PartitionEnsemble.</code><code class="descname">get_unique_partition_indices</code><span class="sig-paren">(</span><em>reindex=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/champ/louvain_ext.html#PartitionEnsemble.get_unique_partition_indices"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#champ.louvain_ext.PartitionEnsemble.get_unique_partition_indices" title="Permalink to this definition">¶</a></dt>
<dd><p>This returns the indices for the partitions who are unique.  This could be larger than the
indices for the unique coeficient since multiple partitions can give rise to the same coefficient.        In practice this has been very rare.  This function can take sometime for larger network with many        partitions since it reindex the partitions labels to ensure they aren&#8217;t permutations of each other.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>reindex</strong> &#8211; if True, will reindex partitions that it is comparing to ensure they are unique under        permutation.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of twin partition (can be empty), list of indicies of unique partitions.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">list,np.array</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="champ.louvain_ext.PartitionEnsemble.twin_partitions">
<code class="descclassname">PartitionEnsemble.</code><code class="descname">twin_partitions</code><a class="headerlink" href="#champ.louvain_ext.PartitionEnsemble.twin_partitions" title="Permalink to this definition">¶</a></dt>
<dd><p>We define twin partitions as those that have the same coefficients but are different partitions.        To find these we look for the diffence in the partitions with the same coefficients.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">List of groups of the indices of partitions that have the same coefficient but         are non-identical.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">list of list (possibly empty if no twins)</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="creating-and-managing-large-partition-sets">
<h2>Creating and Managing Large Partition Sets<a class="headerlink" href="#creating-and-managing-large-partition-sets" title="Permalink to this headline">¶</a></h2>
<p>For large sets of partitions on larger networks, loading the entire set of partitions each time you want to access the data can take a fair amount of time.  Having to load all of the partitions defeats the purpose of using CHAMP to find the optimal subset.  As such we have equiped <code class="xref py py-mod docutils literal"><span class="pre">champ.louvain_ext.PartitionEnsemble</span></code> objects with the ability to write to and access hdf5 files.  Instead of loading the entire set of partitions each time, only the coefficients, the domains of dominance, the underlying graph information is loaded, vastly reducing the
loading time and the memory required for large numbers of runs. Each individual partitions ( or all partitions at once) can be access from file only if needed, as the example below illustrates:</p>
</div>
<div class="section" id="saving-and-loading-partitionensembles">
<h2>Saving and Loading PartitionEnsembles<a class="headerlink" href="#saving-and-loading-partitionensembles" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">champ</span>
<span class="kn">import</span> <span class="nn">igraph</span> <span class="k">as</span> <span class="nn">ig</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">test_graph</span><span class="o">=</span><span class="n">ig</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">Erdos_Renyi</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">p</span><span class="o">=.</span><span class="mi">1</span><span class="p">)</span>
<span class="n">times</span><span class="o">=</span><span class="p">{}</span>
<span class="n">run_nums</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span>

<span class="c1">#saving ensemble</span>
<span class="n">ensemble</span><span class="o">=</span><span class="n">champ</span><span class="o">.</span><span class="n">parallel_louvain</span><span class="p">(</span><span class="n">test_graph</span><span class="p">,</span><span class="n">numprocesses</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">numruns</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fin</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">maxpt</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span> <span class="s2">&quot;Ensemble 1, Optimal subset is </span><span class="si">%d</span><span class="s2"> of </span><span class="si">%d</span><span class="s2"> partitions&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">ind2doms</span><span class="p">),</span><span class="n">ensemble</span><span class="o">.</span><span class="n">numparts</span><span class="p">)</span>
<span class="n">ensemble</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;ensemble1.hdf5&quot;</span><span class="p">,</span><span class="n">hdf5</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#openning created file</span>
<span class="n">ensemble2</span><span class="o">=</span><span class="n">champ</span><span class="o">.</span><span class="n">PartitionEnsemble</span><span class="p">()</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;ensemble1.hdf5&quot;</span><span class="p">)</span>
<span class="c1">#partitions is an internal class the handles access</span>
<span class="nb">print</span> <span class="n">ensemble2</span><span class="o">.</span><span class="n">partitions</span>
<span class="c1">#When sliced a numpy.array is returned</span>
<span class="nb">print</span> <span class="s2">&quot;ensemble2.partitions[38,:10]:</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">ensemble2</span><span class="o">.</span><span class="n">partitions</span><span class="p">[</span><span class="mi">38</span><span class="p">:</span><span class="mi">40</span><span class="p">,:</span><span class="mi">10</span><span class="p">]</span>

<span class="c1">#You can still add partitions as normal.  These are automatically</span>
<span class="c1">#added to the hdf5 file</span>
<span class="n">ensemble2add</span><span class="o">=</span><span class="n">champ</span><span class="o">.</span><span class="n">parallel_louvain</span><span class="p">(</span><span class="n">test_graph</span><span class="p">,</span><span class="n">numprocesses</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">numruns</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fin</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">maxpt</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ensemble2</span><span class="o">.</span><span class="n">add_partitions</span><span class="p">(</span><span class="n">ensemble2add</span><span class="o">.</span><span class="n">get_partition_dictionary</span><span class="p">())</span>
<span class="nb">print</span> <span class="s2">&quot;ensemble 2 has </span><span class="si">%d</span><span class="s2"> of </span><span class="si">%d</span><span class="s2"> partitions dominant&quot;</span>  <span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ensemble2</span><span class="o">.</span><span class="n">ind2doms</span><span class="p">),</span><span class="n">ensemble2</span><span class="o">.</span><span class="n">numparts</span><span class="p">)</span>

<span class="c1">#When open is called, the created EnsemblePartition assumes all</span>
<span class="c1">#the state variables of saved EnsemblePartition, including default save file.</span>
<span class="c1">#If save() is called, it will overwrite the old ensemble file</span>
<span class="nb">print</span> <span class="s2">&quot;ensemble2 default hdf5 file: &quot;</span><span class="p">,</span><span class="n">ensemble2</span><span class="o">.</span><span class="n">hdf5_file</span>
</pre></div>
</div>
<p>Output:</p>
<div class="line-block">
<div class="line">Ensemble 1, Optimal subset is 11 of 200 partitions</div>
<div class="line">200 partitions saved on ensemble1.hdf5</div>
<div class="line">ensemble2.partitions[38,:10]:</div>
<div class="line"><br /></div>
<div class="line-block">
<div class="line">[[1 0 1 0 0 0 0 0 1 1]</div>
<div class="line">[1 1 2 0 1 0 2 1 2 1]]</div>
<div class="line"><br /></div>
</div>
<div class="line">ensemble 2 has 12 of 300 partitions dominant</div>
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<p>You can see with the above example that CHAMP is reapplied everytime new partitions are added to the PartitionEnsemble instance.  In addition, whole PartitionEnsemble objects can be merged together in a similar fashion.  You can either have a new PartitionEnsemble generated, containing the contents of both the inputs.  Or one partition can be merged into the other one.  It automatically uses the larger of the two to merge into.  In addition, if either PartitionEnsemble has an associated hdf5 file, the merger will just expand the contents of the file and keep the same PartitionEnsemble object.</p>
<dl class="method">
<dt id="champ.louvain_ext.PartitionEnsemble.add_partitions">
<code class="descclassname">PartitionEnsemble.</code><code class="descname">add_partitions</code><span class="sig-paren">(</span><em>partitions</em>, <em>maxpt=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/champ/louvain_ext.html#PartitionEnsemble.add_partitions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#champ.louvain_ext.PartitionEnsemble.add_partitions" title="Permalink to this definition">¶</a></dt>
<dd><p>Add additional partitions to the PartitionEnsemble object. Also adds the number of         communities for each.  In the case where PartitionEnsemble was openned from a file, we         just appended these and the other values onto each of the files.  Partitions are not kept         in object, however the other partitions values are.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>partitions</strong> (<em>dict,list</em>) &#8211; list of partitions to add to the PartitionEnsemble</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="champ.louvain_ext.PartitionEnsemble.hdf5_file">
<code class="descclassname">PartitionEnsemble.</code><code class="descname">hdf5_file</code><a class="headerlink" href="#champ.louvain_ext.PartitionEnsemble.hdf5_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Default location for saving/loading PartitionEnsemble if hdf5 format is used.  When this is set        it will automatically resave the PartitionEnsemble into the file specified.</p>
</dd></dl>

<dl class="method">
<dt id="champ.louvain_ext.PartitionEnsemble.save">
<code class="descclassname">PartitionEnsemble.</code><code class="descname">save</code><span class="sig-paren">(</span><em>filename=None</em>, <em>dir='.'</em>, <em>hdf5=None</em>, <em>compress=9</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/champ/louvain_ext.html#PartitionEnsemble.save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#champ.louvain_ext.PartitionEnsemble.save" title="Permalink to this definition">¶</a></dt>
<dd><p>Use pickle or h5py to store representation of PartitionEnsemble in compressed file.  When called         if object has an assocated hdf5_file, this is the default file written to.  Otherwise objected         is stored using pickle.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>filename</strong> &#8211; name of file to write to.  Default is created from name of ParititonEnsemble:             &#8220;%s_PartEnsemble_%d&#8221; %(self.name,self.numparts)</li>
<li><strong>hdf5</strong> (<em>bool</em>) &#8211; save the PartitionEnsemble object as a hdf5 file.  This is         very useful for larger partition sets, especially when you only need to work         with the optimal subset.  If object has hdf5_file attribute saved         this becomes the default</li>
<li><strong>compress</strong> (<em>int [0,9]</em>) &#8211; Level of compression for partitions in hdf5 file.  With less compression, files take         longer to write but take up more space.  9 is default.</li>
<li><strong>dir</strong> (<em>str</em>) &#8211; directory to save graph in.  relative or absolute path.  default is working dir.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="champ.louvain_ext.PartitionEnsemble.save_graph">
<code class="descclassname">PartitionEnsemble.</code><code class="descname">save_graph</code><span class="sig-paren">(</span><em>filename=None</em>, <em>dir='.'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/champ/louvain_ext.html#PartitionEnsemble.save_graph"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#champ.louvain_ext.PartitionEnsemble.save_graph" title="Permalink to this definition">¶</a></dt>
<dd><p>Save a copy of the graph with each of the optimal partitions stored as vertex attributes         in graphml compressed format.  Each partition is attribute names part_gamma where gamma is         the beginning of the partitions domain of dominance</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>filename</strong> &#8211; name of file to write out to.  Default is self.name.graphml.gz or         :type filename: str</li>
<li><strong>dir</strong> (<em>str</em>) &#8211; directory to save graph in.  relative or absolute path.  default is working dir.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="champ.louvain_ext.PartitionEnsemble.open">
<code class="descclassname">PartitionEnsemble.</code><code class="descname">open</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/champ/louvain_ext.html#PartitionEnsemble.open"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#champ.louvain_ext.PartitionEnsemble.open" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads pickled PartitionEnsemble from file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>file</strong> &#8211; filename of pickled PartitionEnsemble Object</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">writes over current instance and returns the reference</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="merging-partitionensembles">
<h2>Merging PartitionEnsembles<a class="headerlink" href="#merging-partitionensembles" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">champ</span>
<span class="kn">import</span> <span class="nn">igraph</span> <span class="k">as</span> <span class="nn">ig</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">test_graph</span><span class="o">=</span><span class="n">ig</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">Erdos_Renyi</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">p</span><span class="o">=.</span><span class="mi">1</span><span class="p">)</span>
<span class="n">times</span><span class="o">=</span><span class="p">{}</span>
<span class="n">run_nums</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">]</span>

<span class="n">ensemble</span><span class="o">=</span><span class="n">champ</span><span class="o">.</span><span class="n">parallel_louvain</span><span class="p">(</span><span class="n">test_graph</span><span class="p">,</span><span class="n">numprocesses</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">numruns</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fin</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">maxpt</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span> <span class="s2">&quot;Ensemble 1, Optimal subset is </span><span class="si">%d</span><span class="s2"> of </span><span class="si">%d</span><span class="s2"> partitions&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ensemble</span><span class="o">.</span><span class="n">ind2doms</span><span class="p">),</span><span class="n">ensemble</span><span class="o">.</span><span class="n">numparts</span><span class="p">)</span>
<span class="n">ensemble</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;ensemble1.hdf5&quot;</span><span class="p">,</span><span class="n">hdf5</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ensemble2</span><span class="o">=</span><span class="n">champ</span><span class="o">.</span><span class="n">parallel_louvain</span><span class="p">(</span><span class="n">test_graph</span><span class="p">,</span><span class="n">numprocesses</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">numruns</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fin</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">maxpt</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span> <span class="s2">&quot;Ensemble 2, Optimal subset is </span><span class="si">%d</span><span class="s2"> of </span><span class="si">%d</span><span class="s2"> partitions&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ensemble2</span><span class="o">.</span><span class="n">ind2doms</span><span class="p">),</span><span class="n">ensemble2</span><span class="o">.</span><span class="n">numparts</span><span class="p">)</span>
<span class="n">ensemble2</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;ensemble2.hdf5&quot;</span><span class="p">,</span><span class="n">hdf5</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#Esembles can be merged as follows:</span>

<span class="c1">#Create new PartitionEnsemble from scratch</span>
<span class="n">ensemble3</span><span class="o">=</span><span class="n">ensemble</span><span class="o">.</span><span class="n">merge_ensemble</span><span class="p">(</span><span class="n">ensemble2</span><span class="p">,</span><span class="n">new</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span> <span class="s2">&quot;Ensemble 3, Optimal subset is </span><span class="si">%d</span><span class="s2"> of </span><span class="si">%d</span><span class="s2"> partitions&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ensemble3</span><span class="o">.</span><span class="n">ind2doms</span><span class="p">),</span><span class="n">ensemble3</span><span class="o">.</span><span class="n">numparts</span><span class="p">)</span>

<span class="c1">#Use largest of the 2 PartitionEnsembles being merged  and modify</span>
<span class="n">ensemble4</span><span class="o">=</span><span class="n">ensemble</span><span class="o">.</span><span class="n">merge_ensemble</span><span class="p">(</span><span class="n">ensemble3</span><span class="p">,</span><span class="n">new</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span> <span class="s2">&quot;Ensemble 4, Optimal subset is </span><span class="si">%d</span><span class="s2"> of </span><span class="si">%d</span><span class="s2"> partitions&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ensemble4</span><span class="o">.</span><span class="n">ind2doms</span><span class="p">),</span><span class="n">ensemble4</span><span class="o">.</span><span class="n">numparts</span><span class="p">)</span>
<span class="nb">print</span> <span class="s2">&quot;ensemble4 is ensemble3: &quot;</span><span class="p">,</span><span class="n">ensemble4</span> <span class="ow">is</span> <span class="n">ensemble3</span>
</pre></div>
</div>
<p>Output:</p>
<div class="line-block">
<div class="line">Ensemble 1, Optimal subset is 13 of 200 partitions</div>
<div class="line">Ensemble 2, Optimal subset is 15 of 200 partitions</div>
<div class="line">Ensemble 3, Optimal subset is 15 of 400 partitions</div>
<div class="line">Ensemble 4, Optimal subset is 15 of 600 partitions</div>
<div class="line">ensemble4 is ensemble3:  True</div>
<div class="line"><br /></div>
</div>
<dl class="method">
<dt id="champ.louvain_ext.PartitionEnsemble.merge_ensemble">
<code class="descclassname">PartitionEnsemble.</code><code class="descname">merge_ensemble</code><span class="sig-paren">(</span><em>otherEnsemble</em>, <em>new=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/champ/louvain_ext.html#PartitionEnsemble.merge_ensemble"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#champ.louvain_ext.PartitionEnsemble.merge_ensemble" title="Permalink to this definition">¶</a></dt>
<dd><p>Combine to PartitionEnsembles.  Checks for concordance in the number of vertices.         Assumes that internal ordering on the graph nodes for each is the same.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>otherEnsemble</strong> &#8211; otherEnsemble to merge</li>
<li><strong>new</strong> (<em>bool</em>) &#8211; create a new PartitionEnsemble object? Otherwise partitions will be loaded into         the one of the original partition ensemble objects (the one with more partitions in the first place).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">PartitionEnsemble reference with merged set of partitions</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="improvement-with-hdf5-saving-and-loading">
<h2>Improvement with HDF5 saving and loading<a class="headerlink" href="#improvement-with-hdf5-saving-and-loading" title="Permalink to this headline">¶</a></h2>
<p>The following example gives a sense of when it is beneficial to save as HDF5 and general runtimes for parallelized Louvain.  We also found that the overhead is dependent on the size of the graph as well, so that for larger graphs with a lower number of partitions, the read/write time on HDF5 can be greater.  Total runtime was about 2.5 hours on 10 CPUs.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">champ</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sbn</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">igraph</span> <span class="k">as</span> <span class="nn">ig</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="k">import</span> <span class="n">time</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">test_graph</span><span class="o">=</span><span class="n">ig</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">Erdos_Renyi</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span><span class="n">p</span><span class="o">=.</span><span class="mi">1</span><span class="p">)</span>

<span class="n">times</span><span class="o">=</span><span class="p">{}</span>
<span class="n">run_nums</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">2000</span><span class="p">,</span><span class="mi">3000</span><span class="p">,</span><span class="mi">10000</span><span class="p">]</span>

<span class="k">for</span> <span class="n">nrun</span> <span class="ow">in</span> <span class="n">run_nums</span> <span class="p">:</span>
    <span class="n">rtimes</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">t</span><span class="o">=</span><span class="n">time</span><span class="p">()</span>
    <span class="n">ens</span><span class="o">=</span><span class="n">champ</span><span class="o">.</span><span class="n">parallel_louvain</span><span class="p">(</span><span class="n">test_graph</span><span class="p">,</span><span class="n">numprocesses</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">numruns</span><span class="o">=</span><span class="n">nrun</span><span class="p">,</span><span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fin</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">maxpt</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">progress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ens</span><span class="o">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;name&#39;</span>
    <span class="n">rtimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t</span><span class="p">)</span>

    <span class="c1">#normal save (gzip)</span>
    <span class="nb">print</span> <span class="s2">&quot;CHAMP running time </span><span class="si">%d</span><span class="s2"> runs: </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">nrun</span><span class="p">,</span><span class="n">rtimes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">t</span><span class="o">=</span><span class="n">time</span><span class="p">()</span>
    <span class="n">ens</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="n">rtimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t</span><span class="p">)</span>
    <span class="n">t</span><span class="o">=</span><span class="n">time</span><span class="p">()</span>

    <span class="c1">#normal open</span>
    <span class="n">t</span><span class="o">=</span><span class="n">time</span><span class="p">()</span>
    <span class="n">newens</span><span class="o">=</span><span class="n">champ</span><span class="o">.</span><span class="n">PartitionEnsemble</span><span class="p">()</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;name_PartEnsemble_</span><span class="si">%d</span><span class="s2">.gz&quot;</span><span class="o">%</span><span class="n">nrun</span><span class="p">)</span>
    <span class="n">rtimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t</span><span class="p">)</span>
    <span class="n">t</span><span class="o">=</span><span class="n">time</span><span class="p">()</span>

    <span class="c1">#save with h5py</span>
    <span class="n">t</span><span class="o">=</span><span class="n">time</span><span class="p">()</span>
    <span class="n">ens</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">hdf5</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">rtimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t</span><span class="p">)</span>
    <span class="n">t</span><span class="o">=</span><span class="n">time</span><span class="p">()</span>

    <span class="c1">#open with hdf5 format</span>
    <span class="n">t</span><span class="o">=</span><span class="n">time</span><span class="p">()</span>
    <span class="n">newes</span><span class="o">=</span><span class="n">champ</span><span class="o">.</span><span class="n">PartitionEnsemble</span><span class="p">()</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;name_PartEnsemble_</span><span class="si">%d</span><span class="s2">.hdf5&quot;</span><span class="o">%</span><span class="n">nrun</span><span class="p">)</span>
    <span class="n">rtimes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t</span><span class="p">)</span>
    <span class="n">times</span><span class="p">[</span><span class="n">nrun</span><span class="p">]</span><span class="o">=</span><span class="n">rtimes</span>

<span class="n">tab</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">run_nums</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;runtime&#39;</span><span class="p">,</span><span class="s1">&#39;save&#39;</span><span class="p">,</span><span class="s1">&#39;load&#39;</span><span class="p">,</span><span class="s1">&#39;hdf5save&#39;</span><span class="p">,</span><span class="s1">&#39;hdf5load&#39;</span><span class="p">])</span>
<span class="n">colors</span><span class="o">=</span><span class="n">sbn</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s1">&#39;Set1&#39;</span><span class="p">,</span><span class="n">n_colors</span><span class="o">=</span><span class="n">tab</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">f</span><span class="p">,(</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">)</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ind</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ind</span><span class="o">==</span><span class="s1">&#39;runtime&#39;</span><span class="p">:</span>
        <span class="n">a1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">tab</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,:],</span><span class="n">label</span><span class="o">=</span><span class="n">ind</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">a2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tab</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">tab</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind</span><span class="p">,:],</span><span class="n">label</span><span class="o">=</span><span class="n">ind</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">a1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;#partitions&quot;</span><span class="p">)</span>
<span class="n">a1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;seconds&quot;</span><span class="p">)</span>
<span class="n">a2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;#partitions&quot;</span><span class="p">)</span>
<span class="n">a2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;seconds&quot;</span><span class="p">)</span>

<span class="n">a2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Comparison of Save and Load Times&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">a1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Runtimes on random ER-graph G(N=1000,p=.1)&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">a1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">a2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>Output:</p>
<div class="line-block">
<div class="line">CHAMP running time 100 runs: 53.771</div>
<div class="line">CHAMP running time 1000 runs: 498.642</div>
<div class="line">CHAMP running time 2000 runs: 988.658</div>
<div class="line">CHAMP running time 3000 runs: 1479.512</div>
<div class="line">CHAMP running time 10000 runs: 5091.727</div>
<div class="line"><br /></div>
</div>
<a class="reference internal image-reference" href="../_images/runtime_ex.png" id="runtime-exp"><img alt="../_images/runtime_ex.png" id="runtime-exp" src="../_images/runtime_ex.png" style="width: 90%;" /></a>
<div class="section" id="references">
<h3>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h3>
<p id="bibtex-bibliography-_static/louvain_ext-0"><table class="docutils citation" frame="void" id="blondel-2008vn" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Vincent&nbsp;D Blondel, Jean-Loup Guillaume, Renaud Lambiotte, and Etienne Lefebvre. Fast unfolding of communities in large networks. <em>Journal of Statistical Mechanics: Theory and Experiment</em>, pages P10008, 2008.</td></tr>
</tbody>
</table>
<table class="docutils citation" frame="void" id="traag-louvain" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Vincent Traag. Louvain igraph. <span><a class="reference external" href="#"></a></span>http://github.com/vtraag/louvain-igraph.</td></tr>
</tbody>
</table>
</p>
<ul class="simple">
<li><a class="reference internal" href="../genindex.html"><span class="std std-ref">Index</span></a></li>
<li><a class="reference internal" href="../search.html"><span class="std std-ref">Search Page</span></a></li>
</ul>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="plotting2.html" class="btn btn-neutral" title="Visualizing Results" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, William Weir.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: ''
        };
    </script>
      <script type="text/javascript" src="jquery.js"></script>
      <script type="text/javascript" src="underscore.js"></script>
      <script type="text/javascript" src="doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>